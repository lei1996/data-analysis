# Data Platform Client

Power by react

## Appendix

现在要做优化的原因是因为，自己已经写了3个策略了， 想从0开始获取数据，然后将数据丢入到 抽象的 class 中，剔除不稳定因素， 
数据做成类中抽象 可以

功能 

通过一个抽象类， 然后 下面不同的策略继承。 比如macd rsi 继承那个公共类.

参数可配置，比如需要 配置 k线 时间， btc 或者 eth ， 用来判断策略是否通用.

策略要足够的稳定。 通过对收益点 来进行开启关闭.


修正数据 配置参数
rsi 
const data = new MACD({
    indicator: EMA,
    shortInterval: 6,
    longInterval: 13,
    signalInterval: 5,
});


类似macd 那种均衡的策略 不需要加修正参数.我想大概原因是因为它只是趋势跟踪，并不是寻找最佳买卖点。(验证确实如此)
自己自定义 的策略就需要添加 修正参数 (比如自己主要是进攻型策略)
当macd histogram 低于0时，放弃这段时间的买卖单. (完成)


指标组合  量也要添加进 指标，但是目前看不出那个指标比较好，rsi???

数据结构应该怎么做呢？

abstract class Indicator
{
    <!-- map: new Map(), // 这个map [id, [open, close]] -->
    prev: '', // 'UP' 开多 'DOWN' 开空
    isLock: false,  // 用来作为 临时锁 比如 当macd histogram 小于0时， 为true
    sum: new Big(0), // 这个是用来累加diff的
    beforeSum: new Big(0), // 修正之前的数据
    afterSum: new Big(0), // 修正之后的数据

    indicator: typeof MACD | typeof RSI, // 指标

    result: {}, // 这个用来存储表格数据

    abstract update(...args: any): void; // 用来更新数据的？？ push 单个k线进去
}

自定调节参数 -> http 请求 -> (数组for循环丢入到自定义指示器买卖中 -> 记录结果修正前修正后的值 -> 绘制图表) 完成




----2021-08-22 ----------
如何将策略操作者 丢到公共的项目呢？ 然后 server 和 client 都可以 import (这个windows下有bug 无法建立软链接) (完成)
添加 mobx 到 client (完成)
server websocket 数据最新k线需要优化. (1分钟的k线中途会卡顿一分钟，不知道什么情况) （完成）
自定义调节参数 (完成)

余额在页面展示. （完成）
操作多空那些信息 列表渲染.
获取所有合约. 然后任务调度去监控不同的交易对 将活跃的交易对 push到一个数组中，进行下一步的数据分析

淘汰机制


先将策略更新到服务端，跑起来，然后客户端继续写策略。👌🏻
前面先写死 只执行btc的 👌🏻

需要将开平仓的逻辑抽象出来成一个独立的 class 因为服务端无法直接使用(完成)


客户端写策略，比如尝试一些自定义的策略.👌🏻
将服务端代码重构，数据结构需要调整，将数据丢入到services 层里面，然后通过方法返回出去.
服务端代码需要进一步优化. 可能需要同时 1分钟 15分钟的监控，在同一个交易对中 所以那个addItem 需要抽象接收不同的数据.

想办法要清除噪音。  避免不必要的开仓.

开平仓class 要重构 要将数据结构分离出来.  （完成）
修正均衡器逻辑，如果收益 macd 不是大于某个数值的话，就lock （完成）

被动开仓 主动开仓

小于50点的不要考虑这个行情, 因为赚不回手续费.

[{
	"symbol": "BTC",
	"contract_code": "BTC-USDT",
	"volume": 1,
	"price": 48383.2,
	"order_price_type": "opponent",
	"order_type": 1,
	"direction": "buy",
	"offset": "open",
	"lever_rate": 5,
	"order_id": 880094114119942100,
	"client_order_id": null,
	"created_at": 1629872388159,
	"trade_volume": 1,
	"trade_turnover": 48.3832,
	"fee": -0.01935328,
	"trade_avg_price": 48383.2,
	"margin_frozen": 0,
	"profit": 0,
	"status": 6,
	"order_source": "api",
	"order_id_str": "880094114119942144",
	"fee_asset": "USDT",
	"liquidation_type": "0",
	"canceled_at": 0,
	"margin_asset": "USDT",
	"margin_account": "USDT",
	"margin_mode": "cross",
	"is_tpsl": 0,
	"real_profit": 0,
	"update_time": null
}, {
	"symbol": "BTC",
	"contract_code": "BTC-USDT",
	"volume": 1,
	"price": 48428.5,
	"order_price_type": "opponent",
	"order_type": 1,
	"direction": "sell",
	"offset": "close",
	"lever_rate": 5,
	"order_id": 880098665195638800,
	"client_order_id": null,
	"created_at": 1629873473221,
	"trade_volume": 1,
	"trade_turnover": 48.4285,
	"fee": -0.0193714,
	"trade_avg_price": 48428.5,
	"margin_frozen": 0,
	"profit": 0.0105,
	"status": 6,
	"order_source": "api",
	"order_id_str": "880098665195638786",
	"fee_asset": "USDT",
	"liquidation_type": "0",
	"canceled_at": 0,
	"margin_asset": "USDT",
	"margin_account": "USDT",
	"margin_mode": "cross",
	"is_tpsl": 0,
	"real_profit": 0.0105,
	"update_time": null
}]

1分钟的k线做量能跟踪 rsi 标记价位 （完成）
数据如何联动呢？

不会有无缘无故的放量. 要么是 压力位 支撑位的网格被吃了.要么就是 顶部 底部 次级反转 的位置.

明天要将 15分钟 的k线数据和1分钟的组合起来. 添加的时候，调1min / 5min的接口去获取当前15分钟的k线.

1分钟监控量能还是需要单独抽出来，资源共享给其他操作员使用.
所以这个class是需要有一个查询最近 n 分钟的量能的api

尝试新方案？  合并数据 1分钟k线合并 5 15分钟k线？ （合并k线数据 完成）
还是通过监听多个不同数据流 合并到一块？？

Subject 多播到多个 Observable 合并5 15 min 的k线.

一个class kline 然后里面count  length 还有一个update  reload kline. getResult  (完成)

围绕一个 核心 来写，比如策略，拿到实际的数据，优化个一周，陪伴这个策略一周.
然后每天将策略的优缺点总结一下，复盘一下。

策略弄好之后， 将周边 比如开平仓的逻辑优化，开平仓历史实盘数据页面渲染，  任务调度，查询活跃的币，然后 push 到map中。

开平仓那个统计数据有问题.实盘和模拟有误差，不知道是diff的值出现了问题还是其他的情况

统计也有问题。(数据的起始位置会造成统计的结果出现偏差).

我不确定是因为手续费的原因还是因为其他的。 不过我觉得 这个策略需要保留的.
双边都是大于0的情况 不开仓  

有一个bug是，当调用api的时候，就会停顿一段时间不开仓，不知道为什么。莫名其妙的bug. （因为两个api调用的时间很短很短，可能有一个终止了.最后只有一个api 是调用成功的。）
平仓之后不开仓了，奇奇怪怪

需要一个策略，4种交易模式（划定边界，剩下的交给程序判断）最后牺牲3个子模式
指标值 最高点 开多开空  最低点开多开空  然后最后留存下来的最优解 实盘开仓.（完成）

每日凌晨重置均衡器

指標要和開平倉的類分離

收集到的问题，比如 rsi 上穿70 之后 没有回落到30。 所以这里70应该有两种状态 需要将现在的镜像一遍
两个都是开多的情况 会重复平仓开仓的情况，实际上是因为两个子策略在一起了。

在上涨趋势中， rsi 的低值是50 高值是 70. 下跌趋势中 rsi 的高值是50 低值是20， 但是我们不取理想值。
我们需要的只是顺应行情。

行情反转的时候，盈利头寸会被一波吃掉。 这是个很头疼的问题.其他开仓又会因为 isLock 锁定导致无法开仓.

均衡器需要重写？ 还是在外面包一层Queue 长度为14的数组？

问题是 
父类class 里面需要 new n个相同的子类class，子类class 相当于不同的分支。
然后子类有一个add()  一个isOk属性 表示这条路是ok的

父类class 需要在每一次push数据的时候去收集子类class 里面的isOk。
用于下一阶段的执行

使用什么指标？ 跟踪收益曲线  


-----------------------------------------------
下一个版本需要确定的事情:

有很多一部分的代码是需要重构的，涉及到业务主体部分的代码。这一部分 
等到我将socket.io 写入项目 写一个数据推送之后.再整理项目结构.
server端的数据结构是待优化的. 因为有一部分数据都是存储在了class 里面的
抽象出来的公共代码 只需要写单元测试.

至于策略 部分，因为我都不清楚程序内部发生了什么，每一次都是感觉在瞎蒙.
回测数据与实盘数据也感觉有问题.但是又不清楚发生了什么.
所以只能等到重构一版本，将代码再精简一轮。同时需要记录日志.


连续开仓的点， 比如开多的点， 开空的点。有开仓位置。 用均线还是什么呢？
总之，没办法有完美的策略。只能完善应对策略失灵的情况.


-----------------------------------------------

聊天室的数据结构整理:

common: {
	name: '1',
	avatar: '头像',
	lastTime: '最后登录/发言时间',
}

user: {
	name: '1',
	avatar: '头像',
	lastLoginTime: '最后登录时间',
}

friend : {

}

group: {

}

message: {
	isRead: false, // 是否已读
}

消息体 读取 user 表中的数据,使用一个队列存储群聊最后发言30个用户的数据，其余的用户通过接口去调用.



将socket 单独一个项目拧出来。但是如何将拧出来的项目与现有的项目整合到一块呢？
如何跨项目去嵌入路由呢？ 这个以后考虑




明天要加单测，不加单测写不了.

不想写了，没法写下去了。
辅助工具，没法很好的控制开平仓的收益。随着起始时间的数据不同，几日之后的结果也不同。到后面完全不相关。
我最初写这个辅助工具只是想在策略失去平衡的时候，终止开仓。
结果现在看来，数据的起始点不同，结果也就不同。
我开始还以为自己找到了圣杯。

均衡器是用来均衡极端策略的，如果一个策略攻防兼备，那么本质上是不需要均衡器的.
我以前误解了，但是好像还是有一些bug.

有一个隐藏的问题需要解决一下，就是15分钟最新k线的问题.
我至今还在想是应该接口合并好，还是